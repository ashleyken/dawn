<script>

function mwApoCustom() {
  function mws_apo_hide_our_variants(selector_container, selector_items) {
    const container = document.querySelectorAll(selector_container);
    if (!container) {
      return;
    }
    for (const i of container) {
      const items = i.querySelectorAll(selector_items);
      for (let item of items) {
        if (item.textContent.indexOf("#MWS Options") >= 0) {
          item.remove();
        }
      }
      if (i.querySelectorAll(selector_items).length === 1) {
        i.style.display = "none";
      }
    }
  }

  function imageElement(id) {
    if (typeof mwApoInit.response !== "undefined") {
      for (const val of Object.values(mwApoInit.response)) {
        for (const key in val.values) {
          if (key == id) {
            if (
              typeof val.values[id].value.images !== "undefined" &&
              val.values[id].value.images.length &&
              val.values[id].value.images[1]
            ) {
              for (const iterator of val.values[id].value.images) {
                if (iterator.hasOwnProperty("url")) {
                  return iterator.url;
                }
              }
            }
          }
        }
      }
    }
  }

function isVisible(e) {
  return !!( e.offsetWidth || e.offsetHeight || e.getClientRects().length );
}

  window.mwApoInit  = window.mwApoInit  || {};
  window.mwApoInit.onEvent = function (event, args) {  
    if (event == "init::finish") {
      mws_apo_hide_our_variants(
        ".selector-wrapper",
        ".single-option-selector option"
      );

      let swatches = document.querySelectorAll('.mw-option--type-swatch .mw-option__value');
      swatches.forEach(element => {
        if (!isVisible(element)) {
          element.classList.add('mw-hidden')
        }
      });
      
      if (document.querySelector(".shopify-payment-button")) {
        document.querySelector(".shopify-payment-button").style.display = "none";

        var mutationObserver = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            document.querySelector(".shopify-payment-button").style.display =
              "none";
          });
        });

        mutationObserver.observe(
          document.getElementsByClassName("shopify-payment-button")[0],
          {
            attributes: true,
            characterData: true,
            childList: true,
            subtree: true,
            attributeOldValue: true,
            characterDataOldValue: true,
          }
        );
      }
    }
  };
  
window.mwApoInit.onCallback = function (event, data) {
  if (event == "applyAttributeStateToHtml::price") {
    $(".grid-item .product__image-wrapper_original_position .forOverlay").attr(
      "style",
      "display: none"
    );

    $(".mw-option__value--selected:not(.mw-hidden)").each(function (
      index,
      element
    ) {
      var $this = $(this);
      var selected = $this.attr("data-value-id");
      const image = imageElement(selected);
      if (typeof image !== "undefined") {
        $(
          ".grid-item .product__image-wrapper_original_position .forOverlay"
        ).each(function (i, el) {
          var $el = $(el);
          if ($el.attr("srcset") === image) {
            $el.removeAttr("style");
          }
        });
      }
    });
  }
  return data;
};

  window.mwApoInit.settings.selectors.product.gallery_container = '.custom_selector';
}
</script>

<style>
  .mw-option__swatch-color {
  	display: block !important;    
  }
  
  .mw-option .mw-option__control--type-select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%20viewBox%3D%220%200%2012%2012%22%3E%3Ctitle%3Edown-arrow%3C%2Ftitle%3E%3Cg%20fill%3D%22%23000000%22%3E%3Cpath%20d%3D%22M10.293%2C3.293%2C6%2C7.586%2C1.707%2C3.293A1%2C1%2C0%2C0%2C0%2C.293%2C4.707l5%2C5a1%2C1%2C0%2C0%2C0%2C1.414%2C0l5-5a1%2C1%2C0%2C1%2C0-1.414-1.414Z%22%20fill%3D%22%23000000%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fsvg%3E");
    background-size: 0.5em;
    background-position: calc(100% - 9px) center;
    background-repeat: no-repeat;
    border: 1px solid #d4d6d8;
    padding: 5px 30px 5px 15px;
    border-radius: 2px;
    font-size: inherit;
    outline: none;
    box-shadow: none;
    color: black;
}

.mw-apo-configure-link {
  color: black;
  font-size: smaller;
}

</style>

