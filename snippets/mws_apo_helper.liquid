<script>
function mws_apo_hide_our_variants(selector_container, selector_items) {
  const container = document.querySelectorAll(selector_container);
  if (!container) {
    return;
  }
  for (const i of container) {
    const items = i.querySelectorAll(selector_items);
    for (let item of items) {
      if (item.textContent.indexOf("#MWS Options") >= 0) {
        item.remove();
      }
    }
    if (i.querySelectorAll(selector_items).length === 1) {
      i.style.display = "none";
    }
  }
}

function imageElement(id, optionType) {
  if (typeof mwApoInit.response !== "undefined") {
    for (const val of Object.values(mwApoInit.response)) {
      for (const key in val.values) {
        if (key == id) {
          if (optionType === "select") {
            if (
              typeof val.values[id].value.images !== "undefined" &&
              val.values[id].value.images.length &&
              val.values[id].value.images[0]
            ) {
              for (const iterator of val.values[id].value.images) {
                if (iterator.hasOwnProperty("url")) {
                  return iterator.url;
                }
              }
            }
          } else {
            if (
              typeof val.values[id].value.images !== "undefined" &&
              val.values[id].value.images.length &&
              val.values[id].value.images[1]
            ) {
              for (const iterator of val.values[id].value.images) {
                if (iterator.hasOwnProperty("url")) {
                  return iterator.url;
                }
              }
            }
          }
        }
      }
    }
  }
}

function overlayImages(params) {
  $(".mw-option__value").each(function (index, element) {
    var $this = $(this);
    var selected = $this.attr("data-value-id");
    const image = imageElement(selected, 'swatch');

    if (typeof image !== "undefined") {
      $this.find(".mw-option__swatch-image").attr("src", image);

      $(".slider__slide .product__modal-opener .product__media").append(
        $(
          '<img class="lazyautosizes lazyloaded forOverlay" style="display: none;" src=' +
            image +
            " srcset=" +
            image +
            " />"
        )
      );
    }
  });

  let selectElement = document.querySelectorAll(
    ".mw-option__control--type-select .mw-option__value"
  );
  selectElement.forEach((element) => {
    let selected = element.getAttribute("value");
    const image = imageElement(selected, "select");

    if (typeof image !== "undefined") {
      element.setAttribute("src", image);

      let img = document.createElement('img');
      img.classList.add("lazyautosizes","lazyloaded","forOverlay");
      img.style.display = 'none';
      img.setAttribute('src', image);
      img.setAttribute('srcset', image)

      let mainImage = document.querySelector('.slider__slide .product__modal-opener .product__media');

      if (mainImage) {
        mainImage.append(img)
      }
    }
  });
}

window.mwApoInit.onEvent = function (event, args) {
  if (event == "init::finish") {
    function isVisible(e) {
      return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length);
    }
    let options = document.querySelectorAll("div.mw-option__value");

    if (options) {
      options.forEach((element) => {
        if (!isVisible(element)) {
          element.classList.add("mw-hidden");
        }
      });
    }

    mws_apo_hide_our_variants(
      ".selector-wrapper",
      ".single-option-selector option"
    );

    setTimeout(() => {
      overlayImages();
    }, 300);

    if (document.querySelector(".shopify-payment-button")) {
      document.querySelector(".shopify-payment-button").style.display = "none";

      var mutationObserver = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
          document.querySelector(".shopify-payment-button").style.display =
            "none";
        });
      });

      mutationObserver.observe(
        document.getElementsByClassName("shopify-payment-button")[0],
        {
          attributes: true,
          characterData: true,
          childList: true,
          subtree: true,
          attributeOldValue: true,
          characterDataOldValue: true,
        }
      );
    }
  }
};

window.mwApoInit.onCallback = function (event, data) {
  if (event == "applyAttributeStateToHtml::price") {
    $(".slider__slide .product__modal-opener .product__media .forOverlay").attr(
      "style",
      "display: none"
    );

    $(".mw-option__value--selected:not(.mw-hidden)").each(function (
      index,
      element
    ) {
      var $this = $(this);
      var selected = $this.attr("data-value-id");
      const image = imageElement(selected);
      if (typeof image !== "undefined") {
        $(
          ".slider__slide .product__modal-opener .product__media .forOverlay"
        ).each(function (i, el) {
          var $el = $(el);
          if ($el.attr("srcset") === image) {
            $el.removeAttr("style");
          }
        });
      }
    });
  }
  return data;
};


window.mwApoInit.settings.selectors.product.gallery_container = '.custom_selector';
</script>

<style>
  .mw-option__swatch-color {
    display: block !important;
  }
  .mw-option--type-radio .mw-option__value  {
    margin-bottom: 15px;
  }
  .mw-option--type-radio .mw-option__value .mw-stack--spacing-tight .mw-stack__item:first-child {
    margin-bottom: -8px;
  }
</style>

{% comment %}CUSTOMIZATION BELOW{% endcomment %}
